# =============================================================================
# Domain Configuration: example.com
# =============================================================================
# This file defines routing rules for a single domain.
# Copy this file and rename it to match your domain: <your-domain>.yaml
#
# File naming convention: <domain-name>.yaml
#   - example.com.yaml
#   - api.example.com.yaml
#   - app.mycompany.io.yaml

# The fully qualified domain name (FQDN) this config handles.
# Envoy will match incoming requests against this domain.
domain: example.com

# Routing mode - how Envoy handles traffic for this domain:
#   - terminate_https_443: Terminate TLS at Envoy, serve HTTPS on port 443
#   - passthrough_443: Pass TLS traffic through unchanged (SNI-based routing)
#   - http_80: Plain HTTP on port 80 (no TLS)
mode: terminate_https_443

# TLS certificate configuration (required when mode is terminate_https_443)
# Envoy will use these certificates to terminate TLS connections.
#
# Certificate sources:
#   - Let's Encrypt: /etc/letsencrypt/live/<domain>/
#   - Custom certs: /etc/envoy/certs/<domain>/
#   - Kubernetes secrets: Mount to a known path
tls:
  # Path to the certificate chain file (fullchain.pem)
  # Should contain the server certificate followed by intermediate certificates.
  cert_chain: /etc/envoy/certs/example.com/fullchain.pem

  # Path to the private key file (privkey.pem)
  # Must match the certificate in cert_chain.
  private_key: /etc/envoy/certs/example.com/privkey.pem

# -----------------------------------------------------------------------------
# Route Definitions
# -----------------------------------------------------------------------------
# Routes are evaluated in order - first match wins.
# Always put more specific routes before catch-all routes.
#
# Match types:
#   - prefix: "/api/"     - Matches paths starting with /api/
#   - path: "/health"     - Matches exact path /health
#   - regex: "^/v[0-9]+/" - Matches regex pattern
routes:
  # -------------------------------------------------------------------------
  # Route 1: API endpoints
  # -------------------------------------------------------------------------
  # Route all API traffic to the API backend service.
  - match: { prefix: "/api/" }
    to_upstream: api_backend
    timeout: 30s

  # -------------------------------------------------------------------------
  # Route 2: Health check endpoint
  # -------------------------------------------------------------------------
  # Expose a health endpoint for load balancers and monitoring.
  - match: { path: "/health" }
    to_upstream: api_backend
    timeout: 5s

  # -------------------------------------------------------------------------
  # Route 3: Static assets
  # -------------------------------------------------------------------------
  # Route static files to the web frontend with longer caching.
  - match: { prefix: "/static/" }
    to_upstream: web_frontend
    timeout: 30s

  # -------------------------------------------------------------------------
  # Route 4: Catch-all - Default route
  # -------------------------------------------------------------------------
  # Handles all requests that don't match above routes.
  # IMPORTANT: This should always be the last route!
  - match: { prefix: "/" }
    to_upstream: web_frontend
    timeout: 60s

